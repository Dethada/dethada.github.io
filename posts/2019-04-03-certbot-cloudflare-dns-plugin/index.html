<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Certbot - Cloudflare DNS Plugin | David Zhu | Blog</title>
<meta name=keywords content="Tutorial,DNS">
<meta name=description content="In this tutorial we will get a wildcard certificate from letsencrypt using the cloudflare dns plugin. For the purpose of this tutorial we will be using example.com as the domain.
Install Cloudflare DNS Plugin This tutorial assumes you have already installed certbot. If you have not, you can follow the instructions from certbot-eff.
sudo apt update sudo apt install python3-certbot-dns-cloudflare -y API Credentials mkdir -p /root/secrets/certbot Retrieve your api key from cloudflare.">
<meta name=author content="David">
<link rel=canonical href=https://dzhy.dev/posts/2019-04-03-certbot-cloudflare-dns-plugin/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://dzhy.dev/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://dzhy.dev/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://dzhy.dev/favicon-32x32.png>
<link rel=apple-touch-icon href=https://dzhy.dev/apple-touch-icon.png>
<link rel=mask-icon href=https://dzhy.dev/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.89.4">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<meta property="og:title" content="Certbot - Cloudflare DNS Plugin">
<meta property="og:description" content="In this tutorial we will get a wildcard certificate from letsencrypt using the cloudflare dns plugin. For the purpose of this tutorial we will be using example.com as the domain.
Install Cloudflare DNS Plugin This tutorial assumes you have already installed certbot. If you have not, you can follow the instructions from certbot-eff.
sudo apt update sudo apt install python3-certbot-dns-cloudflare -y API Credentials mkdir -p /root/secrets/certbot Retrieve your api key from cloudflare.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://dzhy.dev/posts/2019-04-03-certbot-cloudflare-dns-plugin/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2019-04-02T00:00:00+00:00">
<meta property="article:modified_time" content="2019-04-02T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Certbot - Cloudflare DNS Plugin">
<meta name=twitter:description content="In this tutorial we will get a wildcard certificate from letsencrypt using the cloudflare dns plugin. For the purpose of this tutorial we will be using example.com as the domain.
Install Cloudflare DNS Plugin This tutorial assumes you have already installed certbot. If you have not, you can follow the instructions from certbot-eff.
sudo apt update sudo apt install python3-certbot-dns-cloudflare -y API Credentials mkdir -p /root/secrets/certbot Retrieve your api key from cloudflare.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dzhy.dev/posts/"},{"@type":"ListItem","position":2,"name":"Certbot - Cloudflare DNS Plugin","item":"https://dzhy.dev/posts/2019-04-03-certbot-cloudflare-dns-plugin/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Certbot - Cloudflare DNS Plugin","name":"Certbot - Cloudflare DNS Plugin","description":"In this tutorial we will get a wildcard certificate from letsencrypt using the cloudflare dns plugin. For the purpose of this tutorial we will be using example.com as the domain.\nInstall Cloudflare DNS Plugin This tutorial assumes you have already installed certbot. If you have not, you can follow the instructions from certbot-eff.\nsudo apt update sudo apt install python3-certbot-dns-cloudflare -y API Credentials mkdir -p /root/secrets/certbot Retrieve your api key from cloudflare.","keywords":["Tutorial","DNS"],"articleBody":"In this tutorial we will get a wildcard certificate from letsencrypt using the cloudflare dns plugin. For the purpose of this tutorial we will be using example.com as the domain.\nInstall Cloudflare DNS Plugin This tutorial assumes you have already installed certbot. If you have not, you can follow the instructions from certbot-eff.\nsudo apt update sudo apt install python3-certbot-dns-cloudflare -y API Credentials mkdir -p /root/secrets/certbot Retrieve your api key from cloudflare.\n  Login to the Cloudflare account. Go to My Profile. Scroll down to API Keys and locate Global API Key. Click API Key to see your API identifier.   Create the file below with your cloudflare information. We will save the file at /root/secrets/certbot/cloudflare.ini.\n# Cloudflare API credentials used by Certbot\rdns_cloudflare_email = cloudflare@example.com\rdns_cloudflare_api_key = 0123456789abcdef0123456789abcdef01234567\rSecure the folder and file.\nfind /root/secrets -type d -exec chmod 700 {} \\; find /root/secrets -type f -exec chmod 600 {} \\; Requesting for Certificate The --dns-cloudflare-propagation-seconds option defines the number of seconds to wait before doing the validation checks, you can change it accordingly.\nIt is important that we specify the server to be the ACME v2 server as the v1 server does not support wildcard certificates.\ncertbot certonly \\  --preferred-challenges dns \\  --email admin@example.com --dns-cloudflare-credentials /root/secrets/certbot/cloudflare.ini \\  --dns-cloudflare-propagation-seconds 60 \\  -d \"*.example.com\" -d example.com \\  --server https://acme-v02.api.letsencrypt.org/directory \\  --agree-tos We should now have our cert at /etc/letsencrypt/live/example.com/.\nroot@server:~# ls -la /etc/letsencrypt/live/example.com total 12 drwxr-xr-x 2 root root 4096 Apr 3 10:44 . drwx------ 3 root root 4096 Apr 3 10:44 .. lrwxrwxrwx 1 root root 34 Apr 3 10:44 cert.pem - ../../archive/example.com/cert1.pem lrwxrwxrwx 1 root root 35 Apr 3 10:44 chain.pem - ../../archive/example.com/chain1.pem lrwxrwxrwx 1 root root 39 Apr 3 10:44 fullchain.pem - ../../archive/example.com/fullchain1.pem lrwxrwxrwx 1 root root 37 Apr 3 10:44 privkey.pem - ../../archive/example.com/privkey1.pem -rw-r--r-- 1 root root 692 Apr 3 10:44 README Resources  Certbot-eff certbot-dns-cloudflare Cloudflare API Key  ","wordCount":"310","inLanguage":"en","datePublished":"2019-04-02T00:00:00Z","dateModified":"2019-04-02T00:00:00Z","author":{"@type":"Person","name":"David"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dzhy.dev/posts/2019-04-03-certbot-cloudflare-dns-plugin/"},"publisher":{"@type":"Organization","name":"David Zhu | Blog","logo":{"@type":"ImageObject","url":"https://dzhy.dev/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://dzhy.dev/ accesskey=h title="David Zhu | Blog (Alt + H)">David Zhu | Blog</a>
<span class=logo-switches>
</span>
</div>
<ul id=menu>
<li>
<a href=https://dzhy.dev/about/ title=about>
<span>about</span>
</a>
</li>
<li>
<a href=https://dzhy.dev/archive/ title=archive>
<span>archive</span>
</a>
</li>
<li>
<a href=https://dzhy.dev/tags/ title=tags>
<span>tags</span>
</a>
</li>
<li>
<a href=https://dzhy.dev/search/ title="search (Alt + /)" accesskey=/>
<span>search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://dzhy.dev/>Home</a>&nbsp;»&nbsp;<a href=https://dzhy.dev/posts/>Posts</a></div>
<h1 class=post-title>
Certbot - Cloudflare DNS Plugin
</h1>
<div class=post-meta><span title="2019-04-02 00:00:00 +0000 UTC">April 2, 2019</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;David
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul><ul>
<li>
<a href=#install-cloudflare-dns-plugin aria-label="Install Cloudflare DNS Plugin">Install Cloudflare DNS Plugin</a></li>
<li>
<a href=#api-credentials aria-label="API Credentials">API Credentials</a></li>
<li>
<a href=#requesting-for-certificate aria-label="Requesting for Certificate">Requesting for Certificate</a></li></ul>
<li>
<a href=#resources aria-label=Resources>Resources</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>In this tutorial we will get a wildcard certificate from letsencrypt using the cloudflare dns plugin. For the purpose of this tutorial we will be using <code>example.com</code> as the domain.</p>
<h3 id=install-cloudflare-dns-plugin>Install Cloudflare DNS Plugin<a hidden class=anchor aria-hidden=true href=#install-cloudflare-dns-plugin>#</a></h3>
<p>This tutorial assumes you have already installed certbot. If you have not, you can follow the instructions from <a href=https://certbot.eff.org/>certbot-eff</a>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo apt update
sudo apt install python3-certbot-dns-cloudflare -y
</code></pre></div><h3 id=api-credentials>API Credentials<a hidden class=anchor aria-hidden=true href=#api-credentials>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mkdir -p /root/secrets/certbot
</code></pre></div><p>Retrieve your api key from cloudflare.</p>
<blockquote>
<ol>
<li>Login to the Cloudflare account.</li>
<li>Go to My Profile.</li>
<li>Scroll down to API Keys and locate Global API Key.</li>
<li>Click API Key to see your API identifier.</li>
</ol>
</blockquote>
<p>Create the file below with your cloudflare information. We will save the file at <code>/root/secrets/certbot/cloudflare.ini</code>.</p>
<pre tabindex=0><code># Cloudflare API credentials used by Certbot
dns_cloudflare_email = cloudflare@example.com
dns_cloudflare_api_key = 0123456789abcdef0123456789abcdef01234567
</code></pre><p>Secure the folder and file.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>find /root/secrets -type d -exec chmod <span style=color:#ae81ff>700</span> <span style=color:#f92672>{}</span> <span style=color:#ae81ff>\;</span>
find /root/secrets -type f -exec chmod <span style=color:#ae81ff>600</span> <span style=color:#f92672>{}</span> <span style=color:#ae81ff>\;</span>
</code></pre></div><h3 id=requesting-for-certificate>Requesting for Certificate<a hidden class=anchor aria-hidden=true href=#requesting-for-certificate>#</a></h3>
<p>The <code>--dns-cloudflare-propagation-seconds</code> option defines the number of seconds to wait before doing the validation checks, you can change it accordingly.</p>
<p>It is important that we specify the server to be the ACME v2 server as the v1 server does not support wildcard certificates.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>certbot certonly <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --preferred-challenges dns <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --email admin@example.com
  --dns-cloudflare-credentials /root/secrets/certbot/cloudflare.ini <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --dns-cloudflare-propagation-seconds <span style=color:#ae81ff>60</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -d <span style=color:#e6db74>&#34;*.example.com&#34;</span> -d example.com <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --server https://acme-v02.api.letsencrypt.org/directory <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --agree-tos
</code></pre></div><p>We should now have our cert at <code>/etc/letsencrypt/live/example.com/</code>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@server:~# ls -la /etc/letsencrypt/live/example.com
total <span style=color:#ae81ff>12</span>
drwxr-xr-x <span style=color:#ae81ff>2</span> root root <span style=color:#ae81ff>4096</span> Apr  <span style=color:#ae81ff>3</span> 10:44 .
drwx------ <span style=color:#ae81ff>3</span> root root <span style=color:#ae81ff>4096</span> Apr  <span style=color:#ae81ff>3</span> 10:44 ..
lrwxrwxrwx <span style=color:#ae81ff>1</span> root root   <span style=color:#ae81ff>34</span> Apr  <span style=color:#ae81ff>3</span> 10:44 cert.pem -&gt; ../../archive/example.com/cert1.pem
lrwxrwxrwx <span style=color:#ae81ff>1</span> root root   <span style=color:#ae81ff>35</span> Apr  <span style=color:#ae81ff>3</span> 10:44 chain.pem -&gt; ../../archive/example.com/chain1.pem
lrwxrwxrwx <span style=color:#ae81ff>1</span> root root   <span style=color:#ae81ff>39</span> Apr  <span style=color:#ae81ff>3</span> 10:44 fullchain.pem -&gt; ../../archive/example.com/fullchain1.pem
lrwxrwxrwx <span style=color:#ae81ff>1</span> root root   <span style=color:#ae81ff>37</span> Apr  <span style=color:#ae81ff>3</span> 10:44 privkey.pem -&gt; ../../archive/example.com/privkey1.pem
-rw-r--r-- <span style=color:#ae81ff>1</span> root root  <span style=color:#ae81ff>692</span> Apr  <span style=color:#ae81ff>3</span> 10:44 README
</code></pre></div><h2 id=resources>Resources<a hidden class=anchor aria-hidden=true href=#resources>#</a></h2>
<ul>
<li><a href=https://certbot.eff.org/>Certbot-eff</a></li>
<li><a href=https://certbot-dns-cloudflare.readthedocs.io/en/stable/>certbot-dns-cloudflare</a></li>
<li><a href=https://support.cloudflare.com/hc/en-us/articles/200167836-Where-do-I-find-my-Cloudflare-API-key->Cloudflare API Key</a></li>
</ul>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://dzhy.dev/tags/tutorial/>Tutorial</a></li>
<li><a href=https://dzhy.dev/tags/dns/>DNS</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://dzhy.dev/posts/2019-04-06-firefly-iii-setup-with-docker-and-https/>
<span class=title>« Prev Page</span>
<br>
<span>Firefly III Setup with Docker and HTTPS</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://dzhy.dev/>David Zhu | Blog</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script>
<script>mermaid.initialize({startOnLoad:!0,theme:'dark'})</script>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>