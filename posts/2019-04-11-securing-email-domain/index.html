<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Preventing Email Spoofing | David Zhu | Blog</title>
<meta name=keywords content="Security,Email,DNS">
<meta name=description content="Preventing email spoofing is important to all domain owners, even if you are not using your domain for email services as it affects the reputation of your domain. In this post I will talk about how to prevent email spoofing with SPF, DKIM and DMARC.
Sender Policy Framework (SPF) SPF allows the receiver to check that an email claiming to come from a specific domain comes from an IP address authorized by that domain&rsquo;s administrators.">
<meta name=author content="David">
<link rel=canonical href=https://dzhy.dev/posts/2019-04-11-securing-email-domain/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://dzhy.dev/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://dzhy.dev/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://dzhy.dev/favicon-32x32.png>
<link rel=apple-touch-icon href=https://dzhy.dev/apple-touch-icon.png>
<link rel=mask-icon href=https://dzhy.dev/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.89.4">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<meta property="og:title" content="Preventing Email Spoofing">
<meta property="og:description" content="Preventing email spoofing is important to all domain owners, even if you are not using your domain for email services as it affects the reputation of your domain. In this post I will talk about how to prevent email spoofing with SPF, DKIM and DMARC.
Sender Policy Framework (SPF) SPF allows the receiver to check that an email claiming to come from a specific domain comes from an IP address authorized by that domain&rsquo;s administrators.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://dzhy.dev/posts/2019-04-11-securing-email-domain/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2019-04-11T00:00:00+00:00">
<meta property="article:modified_time" content="2019-04-11T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Preventing Email Spoofing">
<meta name=twitter:description content="Preventing email spoofing is important to all domain owners, even if you are not using your domain for email services as it affects the reputation of your domain. In this post I will talk about how to prevent email spoofing with SPF, DKIM and DMARC.
Sender Policy Framework (SPF) SPF allows the receiver to check that an email claiming to come from a specific domain comes from an IP address authorized by that domain&rsquo;s administrators.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dzhy.dev/posts/"},{"@type":"ListItem","position":2,"name":"Preventing Email Spoofing","item":"https://dzhy.dev/posts/2019-04-11-securing-email-domain/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Preventing Email Spoofing","name":"Preventing Email Spoofing","description":"Preventing email spoofing is important to all domain owners, even if you are not using your domain for email services as it affects the reputation of your domain. In this post I will talk about how to prevent email spoofing with SPF, DKIM and DMARC.\nSender Policy Framework (SPF) SPF allows the receiver to check that an email claiming to come from a specific domain comes from an IP address authorized by that domain\u0026rsquo;s administrators.","keywords":["Security","Email","DNS"],"articleBody":"Preventing email spoofing is important to all domain owners, even if you are not using your domain for email services as it affects the reputation of your domain. In this post I will talk about how to prevent email spoofing with SPF, DKIM and DMARC.\nSender Policy Framework (SPF) SPF allows the receiver to check that an email claiming to come from a specific domain comes from an IP address authorized by that domain’s administrators. The list of authorized sending hosts and IP addresses for a domain is in the SPF record for the domain which is published in the DNS TXT records for that domain.\nHow it works The receiver checks if the sender is valid by querying the domain in the message header field Return-Path aka MAIL FROM for SPF record and checking the sender’s IP against that record.\nSetup Place the SPF record at the root of your domain.\n   Directive Effect     -all non-matching emails will be rejected   ~all non-matching emails will be accepted but marked   +all allows any ip to send email from your domain.    This SPF record below will allow emails from 10.0.0.1, 2001:0db8:85a3:0000:0000:8a2e:0370:7334 and all the allowed IPs from the spf record from example.com and reject emails sent from all other IPs.\nv=spf1 ip4:10.0.0.1 ip6:2001:0db8:85a3:0000:0000:8a2e:0370:7334 include:example.com -all\rFor more options check out the rfc.\nThings to Note SPF records cannot include more than ten dns queries.\nA single TXT record cannot be more than 255 characters, but we can concate TXT records to form a SPF record of a longer length.\n The DNS overhead for a reply that contains a single TXT record with two strings is about 34 bytes, plus the length of the hostname that’s being queries (e.g. “spf.example.com” is 15 bytes). So to keep within the 512 byte limit you need to break your SPF into chunks of no more than 478 minus the length of the hostname.\n Another option is SPF record chaining.\nYou can check your spf record using this SPF Checker.\nMacros It is possible to create more complex SPF records using marcros.\nProblem SPF does not validate the From header which is shown in most clients as the actual sender of the message, but uses the Return-Path to determine the sending domain.\nFor example, a email was sent with the Return-Path of example.com and a From field of david@dzhy.dev assuming dzhy.dev have SPF setup to not allow any IPs, if example.com has a SPF record that allows my IP, the SPF check will still pass, because it does not check the From field, instead it checks the Return-Path.\nDomain Keys Identified Mail (DKIM) DKIM checks that an email was indeed send and authorized by the owner of that domain using digital signatures. This DKIM signature is a header that is added to the message and is secured with encryption.\nHow it works The DKIM signature is generated by the MTA (Mail Transfer Agent). It creates a hash of the email. This hash value is encrypted using the private key and attached to the email as the DKIM signature in the header.\nAfter receiving the email, the receiver verifies the DKIM signature using the public key in the TXT record of the domain specified in the signature, by decrypting the DKIM signature and comparing the decrypted hash value with the hash value of the email it received. If these two hashes are the same the MTA knows that the email has not been altered. This gives the user confirmation that the email was actually sent from the listed domain.\nSetup Refer to your email service provider’s documentation. Typically all you have to do is to add a DNS TXT record to your domain.\nFinding DKIM selector The DKIM record is at selector._domainkey.dzhy.dev, the selector can be any string, we can only find out the selector of a domain if we have the DKIM-Signature, of a email sent by that domain.\nIn the signature, the s field is the selector, so in this case s=zoho means the selector is zoho and the DKIM public key will be at zoho._domainkey.dzhy.dev.\nDKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed; t=1554622568; s=zoho; d=dzhy.dev; i=david@dzhy.dev; h=Date:From:To:Message-Id:Subject:MIME-\rVersion:Content-Type; l=721; bh=YLjE/ckf0hWWS6SSYjvfMS06DZjBcD0C0ignKAs7TUs=;\rb=HT4wf4u2t5PiApv9zgAWiyTbC8dwoE5qV7vZbGO+/1t+XUPOOlwGV3tfM/0/GqYl\roVtsVDqykG1B2iKGlXIDJGSU6qzsuzxCmHlv3YaddIR7WWLteCvMM4lOg3ZzwSHtiNx dVwG2fJ/iSgzB1AFrSQJa/C21ZewOKL0J8piwKYg=\rProblem The dkim signature can be valid and have no relation to the From header.\nFor example, I can have the following DKIM signature\nDKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed; t=1554622568; s=zoho; d=dzhy.dev; i=david@dzhy.dev; h=Date:From:To:Message-Id:Subject:MIME-\rVersion:Content-Type; l=721; bh=YLjE/ckf0hWWS6SSYjvfMS06DZjBcD0C0ignKAs7TUs=;\rb=HT4wf4u2t5PiApv9zgAWiyTbC8dwoE5qV7vZbGO+/1t+XUPOOlwGV3tfM/0/GqYl\roVtsVDqykG1B2iKGlXIDJGSU6qzsuzxCmHlv3YaddIR7WWLteCvMM4lOg3ZzwSHtiNx dVwG2fJ/iSgzB1AFrSQJa/C21ZewOKL0J8piwKYg=\rwhich is for the domain dzhy.dev but my From field is david@example.com, this will be valid because the signature is valid for the given domain dzhy.dev, it does not check the signature using the domain in the From field.\nDomain-based Message Authentication, Reporting \u0026 Conformance (DMARC) DMARC builds on the widely deployed SPF and DKIM protocols, to improve and monitor protection of the domain from fraudulent email. It is meant to fix the issues of SPF and DKIM. Implementing SPF and DKIM by themselves does not prevent spoofing, but combined with DMARC they will work great.\nDMARC requires authentication alignment with the domain used in the header From, for both SPF and DKIM. Meaning the domain in DKIM must share the same organizational domain as the From header or be the exact same depending on the configuration, the domain for SPF the Return-Path and the header From should share an organizational domain or be the exact same depending on the configuration.\nHow it works The receiver extracts the domain in the From header, and queries for a DMARC policy record of that domain. If it exists, perform DKIM and SPF checks, then perform Identifier Alignment checks. Emails that fail the DMARC mechanism check are disposed of in accordance with the discovered DMARC policy of the Domain Owner.\nSetup Domain Owner DMARC preferences are stored as DNS TXT records in subdomains named _dmarc. For example, the Domain Owner of example.com would post DMARC preferences in a TXT record at _dmarc.example.com.\nThe table below explains each tag of the sample DMARC policy.\n   Tag Effect     v=DMARC1 Specify DMARC version   p=reject Reject any mail that fails the DMARC check   rua=mailto:dmarc@dzhy.dev Send aggregate reports to dmarc@dzhy.dev   adkim=s DKIM Identifier Alignment strict mode   adkim=s SPF Identifier Alignment strict mode   ruf=mailto:dmarc@dzhy.dev Send failure reports to dmarc@dzhy.dev   fo=1 Generate a DMARC failure report if any checks failed     By default daily aggregate reports will be sent if you set a rua address.\n Sample DMARC policy.\nv=DMARC1; p=reject; rua=mailto:dmarc@dzhy.dev; adkim=s ; aspf=s ; ruf=mailto:dmarc@dzhy.dev ; fo=1\rFor other options refer to rfc7489 Section 6.3\nResources  SPF RFC 7208 DKIM Development, Deployment and Operations DMARC Specification  ","wordCount":"1090","inLanguage":"en","datePublished":"2019-04-11T00:00:00Z","dateModified":"2019-04-11T00:00:00Z","author":{"@type":"Person","name":"David"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dzhy.dev/posts/2019-04-11-securing-email-domain/"},"publisher":{"@type":"Organization","name":"David Zhu | Blog","logo":{"@type":"ImageObject","url":"https://dzhy.dev/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://dzhy.dev/ accesskey=h title="David Zhu | Blog (Alt + H)">David Zhu | Blog</a>
<span class=logo-switches>
</span>
</div>
<ul id=menu>
<li>
<a href=https://dzhy.dev/about/ title=about>
<span>about</span>
</a>
</li>
<li>
<a href=https://dzhy.dev/archive/ title=archive>
<span>archive</span>
</a>
</li>
<li>
<a href=https://dzhy.dev/tags/ title=tags>
<span>tags</span>
</a>
</li>
<li>
<a href=https://dzhy.dev/search/ title="search (Alt + /)" accesskey=/>
<span>search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://dzhy.dev/>Home</a>&nbsp;»&nbsp;<a href=https://dzhy.dev/posts/>Posts</a></div>
<h1 class=post-title>
Preventing Email Spoofing
</h1>
<div class=post-meta><span title="2019-04-11 00:00:00 +0000 UTC">April 11, 2019</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;David
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#sender-policy-framework-spf aria-label="Sender Policy Framework (SPF)">Sender Policy Framework (SPF)</a><ul>
<li>
<a href=#how-it-works aria-label="How it works">How it works</a></li>
<li>
<a href=#setup aria-label=Setup>Setup</a><ul>
<li>
<a href=#things-to-note aria-label="Things to Note">Things to Note</a></li>
<li>
<a href=#macros aria-label=Macros>Macros</a></li></ul>
</li>
<li>
<a href=#problem aria-label=Problem>Problem</a></li></ul>
</li>
<li>
<a href=#domain-keys-identified-mail-dkim aria-label="Domain Keys Identified Mail (DKIM)">Domain Keys Identified Mail (DKIM)</a><ul>
<li>
<a href=#how-it-works-1 aria-label="How it works">How it works</a></li>
<li>
<a href=#setup-1 aria-label=Setup>Setup</a></li>
<li>
<a href=#finding-dkim-selector aria-label="Finding DKIM selector">Finding DKIM selector</a></li>
<li>
<a href=#problem-1 aria-label=Problem>Problem</a></li></ul>
</li>
<li>
<a href=#domain-based-message-authentication-reporting--conformance-dmarc aria-label="Domain-based Message Authentication, Reporting &amp;amp; Conformance (DMARC)">Domain-based Message Authentication, Reporting & Conformance (DMARC)</a></li>
<li>
<a href=#how-it-works-2 aria-label="How it works">How it works</a></li>
<li>
<a href=#setup-2 aria-label=Setup>Setup</a></li>
<li>
<a href=#resources aria-label=Resources>Resources</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>Preventing email spoofing is important to all domain owners, even if you are not using your domain for email services as it affects the reputation of your domain. In this post I will talk about how to prevent email spoofing with SPF, DKIM and DMARC.</p>
<h2 id=sender-policy-framework-spf>Sender Policy Framework (SPF)<a hidden class=anchor aria-hidden=true href=#sender-policy-framework-spf>#</a></h2>
<p>SPF allows the receiver to check that an email claiming to come from a specific domain comes from an IP address authorized by that domain&rsquo;s administrators. The list of authorized sending hosts and IP addresses for a domain is in the SPF record for the domain which is published in the DNS TXT records for that domain.</p>
<h3 id=how-it-works>How it works<a hidden class=anchor aria-hidden=true href=#how-it-works>#</a></h3>
<p>The receiver checks if the sender is valid by querying the domain in the message header field <code>Return-Path</code> aka <code>MAIL FROM</code> for SPF record and checking the sender&rsquo;s IP against that record.</p>
<h3 id=setup>Setup<a hidden class=anchor aria-hidden=true href=#setup>#</a></h3>
<p>Place the SPF record at the root of your domain.</p>
<table>
<thead>
<tr>
<th>Directive</th>
<th>Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td>-all</td>
<td>non-matching emails will be rejected</td>
</tr>
<tr>
<td>~all</td>
<td>non-matching emails will be accepted but marked</td>
</tr>
<tr>
<td>+all</td>
<td>allows any ip to send email from your domain.</td>
</tr>
</tbody>
</table>
<p>This SPF record below will allow emails from <code>10.0.0.1</code>, <code>2001:0db8:85a3:0000:0000:8a2e:0370:7334</code> and all the allowed IPs from the spf record from <code>example.com</code> and reject emails sent from all other IPs.</p>
<pre tabindex=0><code>v=spf1 ip4:10.0.0.1 ip6:2001:0db8:85a3:0000:0000:8a2e:0370:7334 include:example.com -all
</code></pre><p>For more options check out the <a href=https://tools.ietf.org/html/rfc7208#section-4.6.1>rfc</a>.</p>
<h4 id=things-to-note>Things to Note<a hidden class=anchor aria-hidden=true href=#things-to-note>#</a></h4>
<p>SPF records cannot include more than ten dns queries.</p>
<p>A single TXT record cannot be more than 255 characters, but we can <a href=https://kb.isc.org/docs/aa-00356>concate TXT records</a> to form a SPF record of a longer length.</p>
<blockquote>
<p>The DNS overhead for a reply that contains a single TXT record with two strings is about 34 bytes, plus the length of the hostname that’s being queries (e.g. &ldquo;spf.example.com&rdquo; is 15 bytes). So to keep within the 512 byte limit you need to break your SPF into chunks of no more than 478 minus the length of the hostname.</p>
</blockquote>
<p>Another option is <a href=https://help.blacknight.com/hc/en-us/articles/212512389-Creating-large-SPF-records-with-many-entries>SPF record chaining</a>.</p>
<p>You can check your spf record using this <a href=http://spf.myisp.ch/>SPF Checker</a>.</p>
<h4 id=macros>Macros<a hidden class=anchor aria-hidden=true href=#macros>#</a></h4>
<p>It is possible to create more complex SPF records using <a href=https://tools.ietf.org/html/rfc7208#section-7>marcros</a>.</p>
<h3 id=problem>Problem<a hidden class=anchor aria-hidden=true href=#problem>#</a></h3>
<p>SPF does not validate the <code>From</code> header which is shown in most clients as the actual sender of the message, but uses the <code>Return-Path</code> to determine the sending domain.</p>
<p>For example, a email was sent with the <code>Return-Path</code> of <code>example.com</code> and a <code>From</code> field of <code>david@dzhy.dev</code> assuming <code>dzhy.dev</code> have SPF setup to not allow any IPs, if <code>example.com</code> has a SPF record that allows my IP, the SPF check will still pass, because it does not check the <code>From</code> field, instead it checks the <code>Return-Path</code>.</p>
<h2 id=domain-keys-identified-mail-dkim>Domain Keys Identified Mail (DKIM)<a hidden class=anchor aria-hidden=true href=#domain-keys-identified-mail-dkim>#</a></h2>
<p>DKIM checks that an email was indeed send and authorized by the owner of that domain using digital signatures. This DKIM signature is a header that is added to the message and is secured with encryption.</p>
<h3 id=how-it-works-1>How it works<a hidden class=anchor aria-hidden=true href=#how-it-works-1>#</a></h3>
<p>The DKIM signature is generated by the MTA (Mail Transfer Agent). It creates a hash of the email. This hash value is encrypted using the private key and attached to the email as the DKIM signature in the header.</p>
<p>After receiving the email, the receiver verifies the DKIM signature using the public key in the TXT record of the domain specified in the signature, by decrypting the DKIM signature and comparing the decrypted hash value with the hash value of the email it received. If these two hashes are the same the MTA knows that the email has not been altered. This gives the user confirmation that the email was actually sent from the listed domain.</p>
<h3 id=setup-1>Setup<a hidden class=anchor aria-hidden=true href=#setup-1>#</a></h3>
<p>Refer to your email service provider&rsquo;s documentation. Typically all you have to do is to add a DNS TXT record to your domain.</p>
<h3 id=finding-dkim-selector>Finding DKIM selector<a hidden class=anchor aria-hidden=true href=#finding-dkim-selector>#</a></h3>
<p>The DKIM record is at <code>selector._domainkey.dzhy.dev</code>, the selector can be any string, we can only find out the selector of a domain if we have the DKIM-Signature, of a email sent by that domain.</p>
<p>In the signature, the <code>s</code> field is the selector, so in this case <code>s=zoho</code> means the selector is <code>zoho</code> and the DKIM public key will be at <code>zoho._domainkey.dzhy.dev</code>.</p>
<pre tabindex=0><code>DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed; t=1554622568; 
s=zoho; d=dzhy.dev; i=david@dzhy.dev; h=Date:From:To:Message-Id:Subject:MIME-
Version:Content-Type; l=721; bh=YLjE/ckf0hWWS6SSYjvfMS06DZjBcD0C0ignKAs7TUs=;
b=HT4wf4u2t5PiApv9zgAWiyTbC8dwoE5qV7vZbGO+/1t+XUPOOlwGV3tfM/0/GqYl
oVtsVDqykG1B2iKGlXIDJGSU6qzsuzxCmHlv3YaddIR7WWLteCvMM4lOg3ZzwSHtiNx 
dVwG2fJ/iSgzB1AFrSQJa/C21ZewOKL0J8piwKYg=
</code></pre><h3 id=problem-1>Problem<a hidden class=anchor aria-hidden=true href=#problem-1>#</a></h3>
<p>The dkim signature can be valid and have no relation to the <code>From</code> header.</p>
<p>For example, I can have the following DKIM signature</p>
<pre tabindex=0><code>DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed; t=1554622568; 
s=zoho; d=dzhy.dev; i=david@dzhy.dev; h=Date:From:To:Message-Id:Subject:MIME-
Version:Content-Type; l=721; bh=YLjE/ckf0hWWS6SSYjvfMS06DZjBcD0C0ignKAs7TUs=;
b=HT4wf4u2t5PiApv9zgAWiyTbC8dwoE5qV7vZbGO+/1t+XUPOOlwGV3tfM/0/GqYl
oVtsVDqykG1B2iKGlXIDJGSU6qzsuzxCmHlv3YaddIR7WWLteCvMM4lOg3ZzwSHtiNx 
dVwG2fJ/iSgzB1AFrSQJa/C21ZewOKL0J8piwKYg=
</code></pre><p>which is for the domain <code>dzhy.dev</code> but my <code>From</code> field is <code>david@example.com</code>, this will be valid because the signature is valid for the given domain <code>dzhy.dev</code>, it does not check the signature using the domain in the <code>From</code> field.</p>
<h2 id=domain-based-message-authentication-reporting--conformance-dmarc>Domain-based Message Authentication, Reporting & Conformance (DMARC)<a hidden class=anchor aria-hidden=true href=#domain-based-message-authentication-reporting--conformance-dmarc>#</a></h2>
<p>DMARC builds on the widely deployed SPF and DKIM protocols, to improve and monitor protection of the domain from fraudulent email. It is meant to fix the issues of SPF and DKIM. Implementing SPF and DKIM by themselves does not prevent spoofing, but combined with DMARC they will work great.</p>
<p>DMARC requires authentication alignment with the domain used in the header <code>From</code>, for both SPF and DKIM. Meaning the domain in DKIM must share the same <a href=https://tools.ietf.org/html/rfc7489#section-3.2>organizational domain</a> as the <code>From</code> header or be the exact same depending on the configuration, the domain for SPF the <code>Return-Path</code> and the header <code>From</code> should share an <a href=https://tools.ietf.org/html/rfc7489#section-3.2>organizational domain</a> or be the exact same depending on the configuration.</p>
<h2 id=how-it-works-2>How it works<a hidden class=anchor aria-hidden=true href=#how-it-works-2>#</a></h2>
<p>The receiver extracts the domain in the <code>From</code> header, and queries for a DMARC policy record of that domain. If it exists, perform DKIM and SPF checks, then perform Identifier Alignment checks. Emails that fail the DMARC mechanism check are disposed of in accordance with the discovered DMARC policy of the Domain Owner.</p>
<h2 id=setup-2>Setup<a hidden class=anchor aria-hidden=true href=#setup-2>#</a></h2>
<p>Domain Owner DMARC preferences are stored as DNS TXT records in subdomains named <code>_dmarc</code>. For example, the Domain Owner of <code>example.com</code> would post DMARC preferences in a TXT record at <code>_dmarc.example.com</code>.</p>
<p>The table below explains each tag of the sample DMARC policy.</p>
<table>
<thead>
<tr>
<th>Tag</th>
<th>Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td>v=DMARC1</td>
<td>Specify DMARC version</td>
</tr>
<tr>
<td>p=reject</td>
<td>Reject any mail that fails the DMARC check</td>
</tr>
<tr>
<td>rua=mailto:dmarc@dzhy.dev</td>
<td>Send aggregate reports to <code>dmarc@dzhy.dev</code></td>
</tr>
<tr>
<td>adkim=s</td>
<td>DKIM Identifier Alignment strict mode</td>
</tr>
<tr>
<td>adkim=s</td>
<td>SPF Identifier Alignment strict mode</td>
</tr>
<tr>
<td>ruf=mailto:dmarc@dzhy.dev</td>
<td>Send failure reports to <code>dmarc@dzhy.dev</code></td>
</tr>
<tr>
<td>fo=1</td>
<td>Generate a DMARC failure report if any checks failed</td>
</tr>
</tbody>
</table>
<blockquote>
<p>By default daily aggregate reports will be sent if you set a <code>rua</code> address.</p>
</blockquote>
<p>Sample DMARC policy.</p>
<pre tabindex=0><code>v=DMARC1; p=reject; rua=mailto:dmarc@dzhy.dev; adkim=s ; aspf=s ; ruf=mailto:dmarc@dzhy.dev ; fo=1
</code></pre><p>For other options refer to <a href=https://tools.ietf.org/html/rfc7489#section-6.3>rfc7489 Section 6.3</a></p>
<h2 id=resources>Resources<a hidden class=anchor aria-hidden=true href=#resources>#</a></h2>
<ul>
<li><a href=https://tools.ietf.org/html/rfc7208>SPF RFC 7208</a></li>
<li><a href=http://www.dkim.org/specs/draft-ietf-dkim-deployment-11.html>DKIM Development, Deployment and Operations</a></li>
<li><a href=https://dmarc.org/resources/specification/>DMARC Specification</a></li>
</ul>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://dzhy.dev/tags/security/>Security</a></li>
<li><a href=https://dzhy.dev/tags/email/>Email</a></li>
<li><a href=https://dzhy.dev/tags/dns/>DNS</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://dzhy.dev/posts/2019-05-04-where-are-the-strings-in-windows-binaries/>
<span class=title>« Prev Page</span>
<br>
<span>Where are the Strings in Windows Binaries</span>
</a>
<a class=next href=https://dzhy.dev/posts/2019-04-06-firefly-iii-setup-with-docker-and-https/>
<span class=title>Next Page »</span>
<br>
<span>Firefly III Setup with Docker and HTTPS</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://dzhy.dev/>David Zhu | Blog</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script>
<script>mermaid.initialize({startOnLoad:!0,theme:'dark'})</script>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>