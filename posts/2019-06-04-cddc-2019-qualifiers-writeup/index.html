<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>CDDC 2019 Qualifiers Writeup | David Zhu | Blog</title>
<meta name=keywords content="CTF,Crypto,Reverse Engineering,Web">
<meta name=description content="This year&rsquo;s CDDC Qualifiers was very different from the previous year which was more of an &lsquo;red team&rsquo; ctf, this year&rsquo;s qualifiers is a jeopardy style ctf and it&rsquo;s pretty focused on OSINT which I&rsquo;m not really into, but anyways here are the writeups for some of the more interesting challenges I solved.
[B-1] Fight the Binary Monster Category: OSINT_Blue
 Drats, we found an unknown executable that someone uploaded to one of our web servers.">
<meta name=author content="David">
<link rel=canonical href=https://dzhy.dev/posts/2019-06-04-cddc-2019-qualifiers-writeup/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://dzhy.dev/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://dzhy.dev/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://dzhy.dev/favicon-32x32.png>
<link rel=apple-touch-icon href=https://dzhy.dev/apple-touch-icon.png>
<link rel=mask-icon href=https://dzhy.dev/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.89.4">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<meta property="og:title" content="CDDC 2019 Qualifiers Writeup">
<meta property="og:description" content="This year&rsquo;s CDDC Qualifiers was very different from the previous year which was more of an &lsquo;red team&rsquo; ctf, this year&rsquo;s qualifiers is a jeopardy style ctf and it&rsquo;s pretty focused on OSINT which I&rsquo;m not really into, but anyways here are the writeups for some of the more interesting challenges I solved.
[B-1] Fight the Binary Monster Category: OSINT_Blue
 Drats, we found an unknown executable that someone uploaded to one of our web servers.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://dzhy.dev/posts/2019-06-04-cddc-2019-qualifiers-writeup/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2019-06-04T00:00:00+00:00">
<meta property="article:modified_time" content="2019-06-04T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="CDDC 2019 Qualifiers Writeup">
<meta name=twitter:description content="This year&rsquo;s CDDC Qualifiers was very different from the previous year which was more of an &lsquo;red team&rsquo; ctf, this year&rsquo;s qualifiers is a jeopardy style ctf and it&rsquo;s pretty focused on OSINT which I&rsquo;m not really into, but anyways here are the writeups for some of the more interesting challenges I solved.
[B-1] Fight the Binary Monster Category: OSINT_Blue
 Drats, we found an unknown executable that someone uploaded to one of our web servers.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dzhy.dev/posts/"},{"@type":"ListItem","position":2,"name":"CDDC 2019 Qualifiers Writeup","item":"https://dzhy.dev/posts/2019-06-04-cddc-2019-qualifiers-writeup/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CDDC 2019 Qualifiers Writeup","name":"CDDC 2019 Qualifiers Writeup","description":"This year\u0026rsquo;s CDDC Qualifiers was very different from the previous year which was more of an \u0026lsquo;red team\u0026rsquo; ctf, this year\u0026rsquo;s qualifiers is a jeopardy style ctf and it\u0026rsquo;s pretty focused on OSINT which I\u0026rsquo;m not really into, but anyways here are the writeups for some of the more interesting challenges I solved.\n[B-1] Fight the Binary Monster Category: OSINT_Blue\n Drats, we found an unknown executable that someone uploaded to one of our web servers.","keywords":["CTF","Crypto","Reverse Engineering","Web"],"articleBody":"This yearâ€™s CDDC Qualifiers was very different from the previous year which was more of an â€˜red teamâ€™ ctf, this yearâ€™s qualifiers is a jeopardy style ctf and itâ€™s pretty focused on OSINT which Iâ€™m not really into, but anyways here are the writeups for some of the more interesting challenges I solved.\n[B-1] Fight the Binary Monster Category: OSINT_Blue\n Drats, we found an unknown executable that someone uploaded to one of our web servers. How weird, it seems to be make heavy reference to trees. Is the author some kind of environmentalist, perhaps?\n Solution When we execute the binary it asks us for the domain it is accessing.\n .\\tree_monster.exe\rWhat domain is being accessed by this executable file?\rIf we grep for a common TLD .com in the binary, we find pastebin.com and 2 pastebin links.\ncddc/osint_blue/Fight the Binary Monster âœ strings tree_monster.exe| grep '\\.com' https://pastebin.com/raw/EcrLPtRP https://pastebin.com/raw/v1cRRWEW pastebin.com Browsing to https://pastebin.com/raw/v1cRRWEW we get the word post repeated a lot times.\npost post post post post post post post post post post post post post post post post post post post post post post post post post post post\rBrowsing to https://pastebin.com/raw/EcrLPtRP we get a tree. We see characters of the flag being the nodes of the tree, the previous pastebin link is a hint on using post order traversal to trasverse the tree to get the flag. Flag $CDDC19${havesometrees}\rFunShop Category: Crypto\n Oops, I forgot whatâ€™s the product code. Please help me to recover it!\nhttp://funshop.cddc19q.ctf.sg/\n Solution When we click get on fun ant or fun guy we can see it is sending a get request to /page/transaction.php with the corresponding prod_code as the parameter.\nWhen we send one ourself we can see that itâ€™s hinting that thereâ€™s a debug mode we can enable by supplying the debug_mode=1 get parameter.\ncddc/crypto/FunShop âœ curl 'http://funshop.cddc19q.ctf.sg/page/transaction.php?prod_code=94-04-3Q mM-ulP-c0z-k' =1 -- Success: Actually, I'm not an ant. \"I am Groot. :P\" When we supply the debug_mode=1 get parameter, we get the source code of the transcation.php. To get the flag we have to send a prod_code that is not 94-04-3QmM-ulP-c0z-k or W8-31-5053-0kX-QiL-1, but to do this we need to know the private key, lucky for us this is an insecure implementation of a MAC which is vulnerable to hash length extension attack. We get a valid hash and we can append data to it and get the hash for the string with appended data, without having to know the private key. The only requirement for this attack is to know the length of the private key, which we can bruteforce.\nSolve script\n#!/usr/bin/env python3 import hashpumpy import base64 import requests import urllib url = 'http://funshop.cddc19q.ctf.sg/page/transaction.php' r = requests.get('{}?prod_code=94-04-3QmM-ulP-c0z-k'.format(url)) transaction_hash = r.cookies['transaction_hash'] prod_code = base64.b64decode(urllib.parse.unquote(r.cookies['prod_code'])).decode() # brute force the private key length for i in range(1, 200): x = hashpumpy.hashpump(transaction_hash, prod_code, 'data_to_add', i) new_hash = x[0] crafted_data = base64.b64encode(x[1]).decode() cookies = {'prod_code': crafted_data, 'transaction_hash': new_hash} r = requests.get(url, cookies=cookies) if r.text != '\\n': print('PRIVATE_KEY length = {}\\n{}'.format(i, r.text)) exit() print('Failed') cddc/crypto/FunShop âœ ./length_extension.py PRIVATE_KEY length = 14 =1 -- $CDDC19${Me0w_m30w_@wesome!_h0w_c@n_y0u_find_me?_FUNFUN} Flag $CDDC19${Me0w_m30w_@wesome!_h0w_c@n_y0u_find_me?_FUNFUN}\rLemonade Category: Reverse\n If we need lemons to make lemonadeâ€¦ Then what about Lemonade.EXE?\n Solution Looking at the strings in the binary I realized that it is a compiled AutoIT script.\nThen I looked for a decompiler online and I found MyAut2EXE.\nThe tool found the version of AutoIT used to be AutoIT v3.3.14.5, and successfully decompiled it. Now we have the source code of the AutoIT script, and we can see the flag in plaintext in the code.\nLOCAL $INT1 = GUICTRLREAD($INPUT1)\rLOCAL $INT2 = GUICTRLREAD($INPUT2)\rIF $INT1 = \"\" OR $INT2 = \"\" THEN\rMSGBOX(0, \"NOPEEEE\", \"Please input numbers :)\")\rELSEIF $INT1 = 941228 AND $INT2 = 940628 THEN\rMSGBOX(0, \"Congratulations XD!!\", \"$CDDC19${easy_peasy_Autoit_squeezy}\")\rELSEIF NOT STRINGISINT($INT1) OR NOT STRINGISINT($INT2) THEN\rMSGBOX(0, \"NOPEEEE\", \"Only numbers allowed :(\")\rELSE\rMSGBOX(0, \"Result!!\", $INT1 + $INT2)\rFlag $CDDC19${easy_peasy_Autoit_squeezy}\r\\'_'/ Category: Web\n \\'_'/\nhttp://ê°€ë‚˜ë‹¤ë¼ë§ˆë°”ì‚¬ì•„ìì°¨ì¹´íƒ€íŒŒí•˜.cddc19q.ctf.sg/\n Solution When we browse to the site we are given the source code of the php file, I modified it for easier testing locally.\nphp echo \"1: \".strpos($_SERVER[\"QUERY_STRING\"], '_').\"\n\"; // strting must start with _ echo \"2: \".stripos($_SERVER[\"QUERY_STRING\"], '_').\"\n\"; // string must start with _ echo \"3: \".strrpos($_SERVER[\"QUERY_STRING\"], '_').\"\n\"; // last position of _ in string must be 0 echo \"4: \".strripos($_SERVER[\"QUERY_STRING\"], '_').\"\n\"; // last position of _ in string must be 0 echo \"5: \".strstr($_SERVER[\"QUERY_STRING\"], '_').\"\n\"; echo \"6: \".strpbrk($_SERVER[\"QUERY_STRING\"], '_').\"\n\"; echo \"7: \".preg_match(\"/[a-z][0-9._]/\", $_SERVER[\"QUERY_STRING\"]).\"\n\"; echo \"8: \".preg_match(\"/ABCDEFGHIJKLMNOPQRSTUVWXYZ/\", $_SERVER[\"QUERY_STRING\"]).\"\n\"; print_r($_GET); echo \"=========================================================================\n\"; if( strpos($_SERVER[\"QUERY_STRING\"], '_') == true ) { exit(\"\\'1'/\"); } if( stripos($_SERVER[\"QUERY_STRING\"], '_') == true ) { exit(\"\\'2'/\"); } if( strrpos($_SERVER[\"QUERY_STRING\"], '_') == true ) { exit(\"\\'3'/\"); } if( strripos($_SERVER[\"QUERY_STRING\"], '_') == true ) { exit(\"\\'4'/\"); } if( strstr($_SERVER[\"QUERY_STRING\"], '_') == true ) { exit(\"\\'5'/\"); } if( strpbrk($_SERVER[\"QUERY_STRING\"], '_') == true ) { exit(\"\\'6'/\"); } if( preg_match(\"/[a-z][0-9._]/\", $_SERVER[\"QUERY_STRING\"]) ) { exit(\"\\'7'/\"); } if( preg_match(\"/ABCDEFGHIJKLMNOPQRSTUVWXYZ/\", $_SERVER[\"QUERY_STRING\"]) ) { exit(\"\\'8'/\"); } if( isset($_GET[\"_1234567890-ABCDEFGHIJKLMNOPQRSTUVWXYZ-qwertyuiopasdfghjklzxcvbnm_\"]) ) { if( $_GET['_1234567890-ABCDEFGHIJKLMNOPQRSTUVWXYZ-qwertyuiopasdfghjklzxcvbnm_'] == \"ğŸš£â€â™€ï¸ ğŸš£ğŸ»â€â™€ï¸ ğŸš£ğŸ¼â€â™€ï¸ ğŸš£ğŸ½â€â™€ï¸ ğŸš£ğŸ¾â€â™€ï¸ ğŸš£ğŸ¿â€â™€ï¸ ğŸš£â€â™‚ï¸ ğŸš£ğŸ»â€â™‚ï¸ ğŸš£ğŸ¼â€â™‚ï¸ ğŸš£ğŸ½â€â™‚ï¸ ğŸš£ğŸ¾â€â™‚ï¸ ğŸš£ğŸ¿â€â™‚ï¸\" ) { echo \"CTF{Flag}\"; } else { echo \"Param value not correct\"; } } else { echo \"Required param not set\"; } ?After some testing we found out these 2 conditions has to be true.\n strting must start with _ last position of _ in string must be 0  Which is not possible if we want to set the get parameter _1234567890-ABCDEFGHIJKLMNOPQRSTUVWXYZ-qwertyuiopasdfghjklzxcvbnm_. Then it just hit me that the korean subdomain is a hint to the solution, url encoding. Since $_SERVER[\"QUERY_STRING\" gets the query string without parsing it, this should work.\nI used this Cyber Chef recipe to url encode _1234567890-ABCDEFGHIJKLMNOPQRSTUVWXYZ-qwertyuiopasdfghjklzxcvbnm_.\nTo_Hex('Space')\rFind_/_Replace({'option':'Regex','string':'\\\\s'},'%',true,false,true,false)\rFind_/_Replace({'option':'Regex','string':'^'},'%',true,false,true,false)\rThis is our payload url.\nhttp://ê°€ë‚˜ë‹¤ë¼ë§ˆë°”ì‚¬ì•„ìì°¨ì¹´íƒ€íŒŒí•˜.cddc19q.ctf.sg/?%5f%31%32%33%34%35%36%37%38%39%30%2d%41%42%43%44%45%46%47%48%49%4a%4b%4c%4d%4e%4f%50%51%52%53%54%55%56%57%58%59%5a%2d%71%77%65%72%74%79%75%69%6f%70%61%73%64%66%67%68%6a%6b%6c%7a%78%63%76%62%6e%6d%5f=ğŸš£â€â™€ï¸ ğŸš£ğŸ»â€â™€ï¸ ğŸš£ğŸ¼â€â™€ï¸ ğŸš£ğŸ½â€â™€ï¸ ğŸš£ğŸ¾â€â™€ï¸ ğŸš£ğŸ¿â€â™€ï¸ ğŸš£â€â™‚ï¸ ğŸš£ğŸ»â€â™‚ï¸ ğŸš£ğŸ¼â€â™‚ï¸ ğŸš£ğŸ½â€â™‚ï¸ ğŸš£ğŸ¾â€â™‚ï¸ ğŸš£ğŸ¿â€â™‚ï¸\rSure enought it worked.\nFlag $CDDC19${PHP_tricks_are_very_fun!}\r","wordCount":"960","inLanguage":"en","datePublished":"2019-06-04T00:00:00Z","dateModified":"2019-06-04T00:00:00Z","author":{"@type":"Person","name":"David"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dzhy.dev/posts/2019-06-04-cddc-2019-qualifiers-writeup/"},"publisher":{"@type":"Organization","name":"David Zhu | Blog","logo":{"@type":"ImageObject","url":"https://dzhy.dev/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://dzhy.dev/ accesskey=h title="David Zhu | Blog (Alt + H)">David Zhu | Blog</a>
<span class=logo-switches>
</span>
</div>
<ul id=menu>
<li>
<a href=https://dzhy.dev/about/ title=About>
<span>About</span>
</a>
</li>
<li>
<a href=https://dzhy.dev/archive/ title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://dzhy.dev/tags/ title=Tags>
<span>Tags</span>
</a>
</li>
<li>
<a href=https://dzhy.dev/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://dzhy.dev/>Home</a>&nbsp;Â»&nbsp;<a href=https://dzhy.dev/posts/>Posts</a></div>
<h1 class=post-title>
CDDC 2019 Qualifiers Writeup
</h1>
<div class=post-meta><span title="2019-06-04 00:00:00 +0000 UTC">June 4, 2019</span>&nbsp;Â·&nbsp;5 min&nbsp;Â·&nbsp;David
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#b-1-fight-the-binary-monster aria-label="[B-1] Fight the Binary Monster">[B-1] Fight the Binary Monster</a><ul>
<li>
<a href=#solution aria-label=Solution>Solution</a></li>
<li>
<a href=#flag aria-label=Flag>Flag</a></li></ul>
</li>
<li>
<a href=#funshop aria-label=FunShop>FunShop</a><ul>
<li>
<a href=#solution-1 aria-label=Solution>Solution</a></li>
<li>
<a href=#flag-1 aria-label=Flag>Flag</a></li></ul>
</li>
<li>
<a href=#lemonade aria-label=Lemonade>Lemonade</a><ul>
<li>
<a href=#solution-2 aria-label=Solution>Solution</a></li>
<li>
<a href=#flag-2 aria-label=Flag>Flag</a></li></ul>
</li>
<li>
<a href=#_ aria-label="\'_'/">\'_'/</a><ul>
<li>
<a href=#solution-3 aria-label=Solution>Solution</a></li>
<li>
<a href=#flag-3 aria-label=Flag>Flag</a>
</li>
</ul>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>This year&rsquo;s CDDC Qualifiers was very different from the previous year which was more of an &lsquo;red team&rsquo; ctf, this year&rsquo;s qualifiers is a jeopardy style ctf and it&rsquo;s pretty focused on OSINT which I&rsquo;m not really into, but anyways here are the writeups for some of the more interesting challenges I solved.</p>
<h2 id=b-1-fight-the-binary-monster>[B-1] Fight the Binary Monster<a hidden class=anchor aria-hidden=true href=#b-1-fight-the-binary-monster>#</a></h2>
<p>Category: OSINT_Blue</p>
<blockquote>
<p>Drats, we found an unknown executable that someone uploaded to one of our web servers. How weird, it seems to be make heavy reference to trees. Is the author some kind of environmentalist, perhaps?</p>
</blockquote>
<h3 id=solution>Solution<a hidden class=anchor aria-hidden=true href=#solution>#</a></h3>
<p>When we execute the binary it asks us for the domain it is accessing.</p>
<pre tabindex=0><code>&gt; .\tree_monster.exe
What domain is being accessed by this executable file?
</code></pre><p>If we grep for a common TLD <code>.com</code> in the binary, we find <code>pastebin.com</code> and 2 pastebin links.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cddc/osint_blue/Fight the Binary Monster âœ strings tree_monster.exe| grep <span style=color:#e6db74>&#39;\.com&#39;</span>
https://pastebin.com/raw/EcrLPtRP
https://pastebin.com/raw/v1cRRWEW
pastebin.com
</code></pre></div><p>Browsing to <code>https://pastebin.com/raw/v1cRRWEW</code> we get the word <code>post</code> repeated a lot times.</p>
<pre tabindex=0><code>post post post post post post post post post post post post post post post post post post post post post post post post post post post post
</code></pre><p>Browsing to <code>https://pastebin.com/raw/EcrLPtRP</code> we get a tree. We see characters of the flag being the nodes of the tree, the previous pastebin link is a hint on using post order traversal to trasverse the tree to get the flag.
<img loading=lazy src=/2019-06-04-CDDC-2019-Qualifiers-Writeup/tree.png alt=tree>
</p>
<h3 id=flag>Flag<a hidden class=anchor aria-hidden=true href=#flag>#</a></h3>
<pre tabindex=0><code>$CDDC19${havesometrees}
</code></pre><h2 id=funshop>FunShop<a hidden class=anchor aria-hidden=true href=#funshop>#</a></h2>
<p>Category: Crypto</p>
<blockquote>
<p>Oops, I forgot what&rsquo;s the product code. Please help me to recover it!</p>
<p><a href=http://funshop.cddc19q.ctf.sg/>http://funshop.cddc19q.ctf.sg/</a></p>
</blockquote>
<h3 id=solution-1>Solution<a hidden class=anchor aria-hidden=true href=#solution-1>#</a></h3>
<p>When we click get on fun ant or fun guy we can see it is sending a get request to <code>/page/transaction.php</code> with the corresponding prod_code as the parameter.</p>
<p><img loading=lazy src=/2019-06-04-CDDC-2019-Qualifiers-Writeup/funshop.png alt="Challenge site">
</p>
<p>When we send one ourself we can see that it&rsquo;s hinting that there&rsquo;s a debug mode we can enable by supplying the <code>debug_mode=1</code> get parameter.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cddc/crypto/FunShop âœ curl <span style=color:#e6db74>&#39;http://funshop.cddc19q.ctf.sg/page/transaction.php?prod_code=94-04-3Q
</span><span style=color:#e6db74>mM-ulP-c0z-k&#39;</span>
&lt;!-- ?debug_mode<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> --&gt;
Success: Actually, I<span style=color:#960050;background-color:#1e0010>&#39;</span>m not an ant. <span style=color:#e6db74>&#34;I am Groot. :P&#34;</span>
</code></pre></div><p>When we supply the <code>debug_mode=1</code> get parameter, we get the source code of the <code>transcation.php</code>.
<img loading=lazy src=/2019-06-04-CDDC-2019-Qualifiers-Writeup/funshop_sourcecode.png alt="Source code">
</p>
<p>To get the flag we have to send a <code>prod_code</code> that is not <code>94-04-3QmM-ulP-c0z-k</code> or <code>W8-31-5053-0kX-QiL-1</code>, but to do this we need to know the private key, lucky for us this is an insecure implementation of a MAC which is vulnerable to hash length extension attack. We get a valid hash and we can append data to it and get the hash for the string with appended data, without having to know the private key. The only requirement for this attack is to know the length of the private key, which we can bruteforce.</p>
<p>Solve script</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#!/usr/bin/env python3</span>
<span style=color:#f92672>import</span> hashpumpy
<span style=color:#f92672>import</span> base64
<span style=color:#f92672>import</span> requests
<span style=color:#f92672>import</span> urllib

url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://funshop.cddc19q.ctf.sg/page/transaction.php&#39;</span>
r <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>?prod_code=94-04-3QmM-ulP-c0z-k&#39;</span><span style=color:#f92672>.</span>format(url))
transaction_hash <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>cookies[<span style=color:#e6db74>&#39;transaction_hash&#39;</span>]
prod_code <span style=color:#f92672>=</span> base64<span style=color:#f92672>.</span>b64decode(urllib<span style=color:#f92672>.</span>parse<span style=color:#f92672>.</span>unquote(r<span style=color:#f92672>.</span>cookies[<span style=color:#e6db74>&#39;prod_code&#39;</span>]))<span style=color:#f92672>.</span>decode()

<span style=color:#75715e># brute force the private key length</span>
<span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>200</span>):
    x <span style=color:#f92672>=</span> hashpumpy<span style=color:#f92672>.</span>hashpump(transaction_hash,
        prod_code,
        <span style=color:#e6db74>&#39;data_to_add&#39;</span>,
        i)

    new_hash <span style=color:#f92672>=</span> x[<span style=color:#ae81ff>0</span>]
    crafted_data <span style=color:#f92672>=</span> base64<span style=color:#f92672>.</span>b64encode(x[<span style=color:#ae81ff>1</span>])<span style=color:#f92672>.</span>decode()

    cookies <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;prod_code&#39;</span>: crafted_data, <span style=color:#e6db74>&#39;transaction_hash&#39;</span>: new_hash}

    r <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(url, cookies<span style=color:#f92672>=</span>cookies)

    <span style=color:#66d9ef>if</span> r<span style=color:#f92672>.</span>text <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;&lt;!-- ?debug_mode=1 --&gt;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>:
        print(<span style=color:#e6db74>&#39;PRIVATE_KEY length = </span><span style=color:#e6db74>{}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(i, r<span style=color:#f92672>.</span>text))
        exit()

print(<span style=color:#e6db74>&#39;Failed&#39;</span>)
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cddc/crypto/FunShop âœ ./length_extension.py
PRIVATE_KEY length <span style=color:#f92672>=</span> <span style=color:#ae81ff>14</span>
&lt;!-- ?debug_mode<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> --&gt;
$CDDC19<span style=color:#e6db74>${</span>Me0w_m30w_@wesome!_h0w_c@n_y0u_find_me?_FUNFUN<span style=color:#e6db74>}</span>
</code></pre></div><h3 id=flag-1>Flag<a hidden class=anchor aria-hidden=true href=#flag-1>#</a></h3>
<pre tabindex=0><code>$CDDC19${Me0w_m30w_@wesome!_h0w_c@n_y0u_find_me?_FUNFUN}
</code></pre><h2 id=lemonade>Lemonade<a hidden class=anchor aria-hidden=true href=#lemonade>#</a></h2>
<p>Category: Reverse</p>
<blockquote>
<p>If we need lemons to make lemonade&mldr; Then what about Lemonade.EXE?</p>
</blockquote>
<h3 id=solution-2>Solution<a hidden class=anchor aria-hidden=true href=#solution-2>#</a></h3>
<p>Looking at the strings in the binary I realized that it is a compiled AutoIT script.</p>
<p><img loading=lazy src=/2019-06-04-CDDC-2019-Qualifiers-Writeup/autoit.png alt="Strings in the binary">
</p>
<p>Then I looked for a decompiler online and I found <a href=https://files.planet-dl.org/Cw2k/MyAutToExe/index.html>MyAut2EXE</a>.</p>
<p>The tool found the version of AutoIT used to be <code>AutoIT v3.3.14.5</code>, and successfully decompiled it. Now we have the source code of the AutoIT script, and we can see the flag in plaintext in the code.</p>
<pre tabindex=0><code class=language-au3 data-lang=au3>LOCAL $INT1 = GUICTRLREAD($INPUT1)
LOCAL $INT2 = GUICTRLREAD($INPUT2)
IF $INT1 = &quot;&quot; OR $INT2 = &quot;&quot; THEN

    MSGBOX(0, &quot;NOPEEEE&quot;, &quot;Please input numbers :)&quot;)
ELSEIF $INT1 = 941228 AND $INT2 = 940628 THEN
    MSGBOX(0, &quot;Congratulations XD!!&quot;, &quot;$CDDC19${easy_peasy_Autoit_squeezy}&quot;)
ELSEIF NOT STRINGISINT($INT1) OR NOT STRINGISINT($INT2) THEN
    MSGBOX(0, &quot;NOPEEEE&quot;, &quot;Only numbers allowed :(&quot;)
ELSE
    MSGBOX(0, &quot;Result!!&quot;, $INT1 + $INT2)
</code></pre><h3 id=flag-2>Flag<a hidden class=anchor aria-hidden=true href=#flag-2>#</a></h3>
<pre tabindex=0><code>$CDDC19${easy_peasy_Autoit_squeezy}
</code></pre><h2 id=_>\'_'/<a hidden class=anchor aria-hidden=true href=#_>#</a></h2>
<p>Category: Web</p>
<blockquote>
<p>\'_'/</p>
<p>http://ê°€ë‚˜ë‹¤ë¼ë§ˆë°”ì‚¬ì•„ìì°¨ì¹´íƒ€íŒŒí•˜.cddc19q.ctf.sg/</p>
</blockquote>
<h3 id=solution-3>Solution<a hidden class=anchor aria-hidden=true href=#solution-3>#</a></h3>
<p>When we browse to the site we are given the source code of the php file, I modified it for easier testing locally.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;1: &#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>strpos</span>($_SERVER[<span style=color:#e6db74>&#34;QUERY_STRING&#34;</span>], <span style=color:#e6db74>&#39;_&#39;</span>)<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&lt;br&gt;&#34;</span>;    <span style=color:#75715e>// strting must start with _
</span><span style=color:#75715e></span><span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;2: &#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>stripos</span>($_SERVER[<span style=color:#e6db74>&#34;QUERY_STRING&#34;</span>], <span style=color:#e6db74>&#39;_&#39;</span>)<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&lt;br&gt;&#34;</span>;   <span style=color:#75715e>// string must start with _
</span><span style=color:#75715e></span><span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;3: &#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>strrpos</span>($_SERVER[<span style=color:#e6db74>&#34;QUERY_STRING&#34;</span>], <span style=color:#e6db74>&#39;_&#39;</span>)<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&lt;br&gt;&#34;</span>;   <span style=color:#75715e>// last position of _ in string must be 0
</span><span style=color:#75715e></span><span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;4: &#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>strripos</span>($_SERVER[<span style=color:#e6db74>&#34;QUERY_STRING&#34;</span>], <span style=color:#e6db74>&#39;_&#39;</span>)<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&lt;br&gt;&#34;</span>;  <span style=color:#75715e>// last position of _ in string must be 0
</span><span style=color:#75715e></span><span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;5: &#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>strstr</span>($_SERVER[<span style=color:#e6db74>&#34;QUERY_STRING&#34;</span>], <span style=color:#e6db74>&#39;_&#39;</span>)<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&lt;br&gt;&#34;</span>;
<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;6: &#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>strpbrk</span>($_SERVER[<span style=color:#e6db74>&#34;QUERY_STRING&#34;</span>], <span style=color:#e6db74>&#39;_&#39;</span>)<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&lt;br&gt;&#34;</span>;
<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;7: &#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#34;/[a-z][0-9._]/&#34;</span>, $_SERVER[<span style=color:#e6db74>&#34;QUERY_STRING&#34;</span>])<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&lt;br&gt;&#34;</span>;
<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;8: &#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#34;/ABCDEFGHIJKLMNOPQRSTUVWXYZ/&#34;</span>, $_SERVER[<span style=color:#e6db74>&#34;QUERY_STRING&#34;</span>])<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&lt;br&gt;&#34;</span>;
<span style=color:#a6e22e>print_r</span>($_GET);
<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;=========================================================================&lt;br&gt;&#34;</span>;

<span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>strpos</span>($_SERVER[<span style=color:#e6db74>&#34;QUERY_STRING&#34;</span>], <span style=color:#e6db74>&#39;_&#39;</span>) <span style=color:#f92672>==</span> <span style=color:#66d9ef>true</span> ) {
    <span style=color:#66d9ef>exit</span>(<span style=color:#e6db74>&#34;\&#39;1&#39;/&#34;</span>);
}

<span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>stripos</span>($_SERVER[<span style=color:#e6db74>&#34;QUERY_STRING&#34;</span>], <span style=color:#e6db74>&#39;_&#39;</span>) <span style=color:#f92672>==</span> <span style=color:#66d9ef>true</span> ) {
    <span style=color:#66d9ef>exit</span>(<span style=color:#e6db74>&#34;\&#39;2&#39;/&#34;</span>);
}

<span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>strrpos</span>($_SERVER[<span style=color:#e6db74>&#34;QUERY_STRING&#34;</span>], <span style=color:#e6db74>&#39;_&#39;</span>) <span style=color:#f92672>==</span> <span style=color:#66d9ef>true</span> ) {
    <span style=color:#66d9ef>exit</span>(<span style=color:#e6db74>&#34;\&#39;3&#39;/&#34;</span>);
}

<span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>strripos</span>($_SERVER[<span style=color:#e6db74>&#34;QUERY_STRING&#34;</span>], <span style=color:#e6db74>&#39;_&#39;</span>) <span style=color:#f92672>==</span> <span style=color:#66d9ef>true</span> ) {
    <span style=color:#66d9ef>exit</span>(<span style=color:#e6db74>&#34;\&#39;4&#39;/&#34;</span>);
}

<span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>strstr</span>($_SERVER[<span style=color:#e6db74>&#34;QUERY_STRING&#34;</span>], <span style=color:#e6db74>&#39;_&#39;</span>) <span style=color:#f92672>==</span> <span style=color:#66d9ef>true</span> ) {
    <span style=color:#66d9ef>exit</span>(<span style=color:#e6db74>&#34;\&#39;5&#39;/&#34;</span>);
}

<span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>strpbrk</span>($_SERVER[<span style=color:#e6db74>&#34;QUERY_STRING&#34;</span>], <span style=color:#e6db74>&#39;_&#39;</span>) <span style=color:#f92672>==</span> <span style=color:#66d9ef>true</span> ) {
    <span style=color:#66d9ef>exit</span>(<span style=color:#e6db74>&#34;\&#39;6&#39;/&#34;</span>);
}

<span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#34;/[a-z][0-9._]/&#34;</span>, $_SERVER[<span style=color:#e6db74>&#34;QUERY_STRING&#34;</span>]) ) {
    <span style=color:#66d9ef>exit</span>(<span style=color:#e6db74>&#34;\&#39;7&#39;/&#34;</span>);
}

<span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#34;/ABCDEFGHIJKLMNOPQRSTUVWXYZ/&#34;</span>, $_SERVER[<span style=color:#e6db74>&#34;QUERY_STRING&#34;</span>]) ) {
    <span style=color:#66d9ef>exit</span>(<span style=color:#e6db74>&#34;\&#39;8&#39;/&#34;</span>);
}

<span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#34;_1234567890-ABCDEFGHIJKLMNOPQRSTUVWXYZ-qwertyuiopasdfghjklzxcvbnm_&#34;</span>]) ) {
    <span style=color:#66d9ef>if</span>( $_GET[<span style=color:#e6db74>&#39;_1234567890-ABCDEFGHIJKLMNOPQRSTUVWXYZ-qwertyuiopasdfghjklzxcvbnm_&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;ğŸš£â€â™€ï¸ ğŸš£ğŸ»â€â™€ï¸ ğŸš£ğŸ¼â€â™€ï¸ ğŸš£ğŸ½â€â™€ï¸ ğŸš£ğŸ¾â€â™€ï¸ ğŸš£ğŸ¿â€â™€ï¸ ğŸš£â€â™‚ï¸ ğŸš£ğŸ»â€â™‚ï¸ ğŸš£ğŸ¼â€â™‚ï¸ ğŸš£ğŸ½â€â™‚ï¸ ğŸš£ğŸ¾â€â™‚ï¸ ğŸš£ğŸ¿â€â™‚ï¸&#34;</span> ) {
        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;CTF{Flag}&#34;</span>;
    } <span style=color:#66d9ef>else</span> {
        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Param value not correct&#34;</span>;
    }
}
<span style=color:#66d9ef>else</span> {
    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Required param not set&#34;</span>;
}
<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>After some testing we found out these 2 conditions has to be true.</p>
<ol>
<li>strting must start with _</li>
<li>last position of _ in string must be 0</li>
</ol>
<p>Which is not possible if we want to set the get parameter <code>_1234567890-ABCDEFGHIJKLMNOPQRSTUVWXYZ-qwertyuiopasdfghjklzxcvbnm_</code>. Then it just hit me that the korean subdomain is a hint to the solution, url encoding. Since <code>$_SERVER["QUERY_STRING"</code> gets the query string without parsing it, this should work.</p>
<p>I used this Cyber Chef recipe to url encode <code>_1234567890-ABCDEFGHIJKLMNOPQRSTUVWXYZ-qwertyuiopasdfghjklzxcvbnm_</code>.</p>
<pre tabindex=0><code>To_Hex('Space')
Find_/_Replace({'option':'Regex','string':'\\s'},'%',true,false,true,false)
Find_/_Replace({'option':'Regex','string':'^'},'%',true,false,true,false)
</code></pre><p>This is our payload url.</p>
<pre tabindex=0><code>http://ê°€ë‚˜ë‹¤ë¼ë§ˆë°”ì‚¬ì•„ìì°¨ì¹´íƒ€íŒŒí•˜.cddc19q.ctf.sg/?%5f%31%32%33%34%35%36%37%38%39%30%2d%41%42%43%44%45%46%47%48%49%4a%4b%4c%4d%4e%4f%50%51%52%53%54%55%56%57%58%59%5a%2d%71%77%65%72%74%79%75%69%6f%70%61%73%64%66%67%68%6a%6b%6c%7a%78%63%76%62%6e%6d%5f=ğŸš£â€â™€ï¸ ğŸš£ğŸ»â€â™€ï¸ ğŸš£ğŸ¼â€â™€ï¸ ğŸš£ğŸ½â€â™€ï¸ ğŸš£ğŸ¾â€â™€ï¸ ğŸš£ğŸ¿â€â™€ï¸ ğŸš£â€â™‚ï¸ ğŸš£ğŸ»â€â™‚ï¸ ğŸš£ğŸ¼â€â™‚ï¸ ğŸš£ğŸ½â€â™‚ï¸ ğŸš£ğŸ¾â€â™‚ï¸ ğŸš£ğŸ¿â€â™‚ï¸
</code></pre><p>Sure enought it worked.</p>
<p><img loading=lazy src=/2019-06-04-CDDC-2019-Qualifiers-Writeup/php_flag.png alt>
</p>
<h3 id=flag-3>Flag<a hidden class=anchor aria-hidden=true href=#flag-3>#</a></h3>
<pre tabindex=0><code>$CDDC19${PHP_tricks_are_very_fun!}
</code></pre>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://dzhy.dev/tags/ctf/>CTF</a></li>
<li><a href=https://dzhy.dev/tags/crypto/>Crypto</a></li>
<li><a href=https://dzhy.dev/tags/reverse-engineering/>Reverse Engineering</a></li>
<li><a href=https://dzhy.dev/tags/web/>Web</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://dzhy.dev/posts/2019-06-14-cddc-2019-lscvm-writeup/>
<span class=title>Â« Prev Page</span>
<br>
<span>CDDC 2019 LSCVM Writeup</span>
</a>
<a class=next href=https://dzhy.dev/posts/2019-05-21-system32-magic/>
<span class=title>Next Page Â»</span>
<br>
<span>System32 Magic</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://dzhy.dev/>David Zhu | Blog</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script>
<script>mermaid.initialize({startOnLoad:!0,theme:'dark'})</script>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>