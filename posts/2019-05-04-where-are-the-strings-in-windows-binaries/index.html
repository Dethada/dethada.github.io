<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Where are the Strings in Windows Binaries | David Zhu | Blog</title>
<meta name=keywords content="Windows,Reverse Engineering">
<meta name=description content="Prelude The Windows Binaries I&rsquo;m talking about here are the ones that comes default with Windows provided by Microsoft.
Searching for Strings in the binary I was analyzing a Windows binary C:\Windows\System32\where.exe when I realized the help text of the binary cannot be found anywhere in the binary.
After some futher investigation using Process Monitor from Windows Sysinternals I found out that it is reading from C:\Windows\System32\en-US\where.exe.mui during it&rsquo;s execution.">
<meta name=author content="David">
<link rel=canonical href=https://dzhy.dev/posts/2019-05-04-where-are-the-strings-in-windows-binaries/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://dzhy.dev/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://dzhy.dev/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://dzhy.dev/favicon-32x32.png>
<link rel=apple-touch-icon href=https://dzhy.dev/apple-touch-icon.png>
<link rel=mask-icon href=https://dzhy.dev/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.89.4">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<meta property="og:title" content="Where are the Strings in Windows Binaries">
<meta property="og:description" content="Prelude The Windows Binaries I&rsquo;m talking about here are the ones that comes default with Windows provided by Microsoft.
Searching for Strings in the binary I was analyzing a Windows binary C:\Windows\System32\where.exe when I realized the help text of the binary cannot be found anywhere in the binary.
After some futher investigation using Process Monitor from Windows Sysinternals I found out that it is reading from C:\Windows\System32\en-US\where.exe.mui during it&rsquo;s execution.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://dzhy.dev/posts/2019-05-04-where-are-the-strings-in-windows-binaries/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2019-05-04T00:00:00+00:00">
<meta property="article:modified_time" content="2019-05-04T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Where are the Strings in Windows Binaries">
<meta name=twitter:description content="Prelude The Windows Binaries I&rsquo;m talking about here are the ones that comes default with Windows provided by Microsoft.
Searching for Strings in the binary I was analyzing a Windows binary C:\Windows\System32\where.exe when I realized the help text of the binary cannot be found anywhere in the binary.
After some futher investigation using Process Monitor from Windows Sysinternals I found out that it is reading from C:\Windows\System32\en-US\where.exe.mui during it&rsquo;s execution.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dzhy.dev/posts/"},{"@type":"ListItem","position":2,"name":"Where are the Strings in Windows Binaries","item":"https://dzhy.dev/posts/2019-05-04-where-are-the-strings-in-windows-binaries/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Where are the Strings in Windows Binaries","name":"Where are the Strings in Windows Binaries","description":"Prelude The Windows Binaries I\u0026rsquo;m talking about here are the ones that comes default with Windows provided by Microsoft.\nSearching for Strings in the binary I was analyzing a Windows binary C:\\Windows\\System32\\where.exe when I realized the help text of the binary cannot be found anywhere in the binary.\nAfter some futher investigation using Process Monitor from Windows Sysinternals I found out that it is reading from C:\\Windows\\System32\\en-US\\where.exe.mui during it\u0026rsquo;s execution.","keywords":["Windows","Reverse Engineering"],"articleBody":"Prelude The Windows Binaries I’m talking about here are the ones that comes default with Windows provided by Microsoft.\nSearching for Strings in the binary I was analyzing a Windows binary C:\\Windows\\System32\\where.exe when I realized the help text of the binary cannot be found anywhere in the binary.\nAfter some futher investigation using Process Monitor from Windows Sysinternals I found out that it is reading from C:\\Windows\\System32\\en-US\\where.exe.mui during it’s execution.\nSearching for Strings in the MUI I did some googling to find out more about the MUI file type and realized that it’s how Windows enable support for different user interface languages.\n Multilingual User Interface (MUI) enables the localization of user interfaces for globalized applications. MUI also supports the creation of resources for any number of user interface languages.\n Further googling on how to open it says that it can be opened using 7zip, so I did and found the strings in .rsrc\\string.txt in the archieve.\n52\tType \"WHERE /?\" for usage help.\\n\r58\tERROR: Invalid directory specified.\\n\r60\tERROR: \"$env:pattern\" cannot be used with /R.\\n\r63\tERROR: Missing pattern in \"$env:pattern\".\\n\r64\tINFO: Could not find \"%s\".\\n\r--------------------------snip--------------------------\rWhat’s weird is when I ran linux’s strings on the MUI file which did not manage to find the strings in the MUI file, so I initially thought that the MUI file is compressed.\nI then ran file on where.exe.mui and it returned PE32 executable (DLL) (GUI) Intel 80386, for MS Windows, I thought that’s weird, so I tried opening the file in CFF Explorer and it worked! So a MUI file is actually a PE file.\nIf we check the resource directories of where.exe.mui using CFF Explorer we can see a resource directory called String Tables. If we check the data within the Directory, we can find all the strings we previously seen using 7zip.\nThe only thing that’s weird was each character was followed by a null byte, which turns out to be because the strings are stored as unicode. Now it makes sense why linux’s strings did not find anything, it does not search for unicode strings. I tried again with the strings tool from Windows Sysinternals and it managed to find the strings because it also searches for unicode strings.\nI also looked at bash.exe.mui and realized that the strings can also be in the MESSAGETABLE section of the resource directory, which have the ID of 0xb.\n All the resource type can be found from the Microsoft Documentation.\n Ending Notes Most of the Windows binaries does this, but not all, if you want to extract all the strings used by a Windows binary you should combine finding strings in the binary and the MUI.\nThe strings can be in STRING (ID of 0x6) and MESSAGETABLE (ID of 0xb) section of the resource directory of the MUI file.\nI have made a tool in rust to retrieve the strings from a MUI file.\n","wordCount":"485","inLanguage":"en","datePublished":"2019-05-04T00:00:00Z","dateModified":"2019-05-04T00:00:00Z","author":{"@type":"Person","name":"David"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dzhy.dev/posts/2019-05-04-where-are-the-strings-in-windows-binaries/"},"publisher":{"@type":"Organization","name":"David Zhu | Blog","logo":{"@type":"ImageObject","url":"https://dzhy.dev/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://dzhy.dev/ accesskey=h title="David Zhu | Blog (Alt + H)">David Zhu | Blog</a>
<span class=logo-switches>
</span>
</div>
<ul id=menu>
<li>
<a href=https://dzhy.dev/about/ title=about>
<span>about</span>
</a>
</li>
<li>
<a href=https://dzhy.dev/archive/ title=archive>
<span>archive</span>
</a>
</li>
<li>
<a href=https://dzhy.dev/tags/ title=tags>
<span>tags</span>
</a>
</li>
<li>
<a href=https://dzhy.dev/search/ title="search (Alt + /)" accesskey=/>
<span>search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://dzhy.dev/>Home</a>&nbsp;»&nbsp;<a href=https://dzhy.dev/posts/>Posts</a></div>
<h1 class=post-title>
Where are the Strings in Windows Binaries
</h1>
<div class=post-meta><span title="2019-05-04 00:00:00 +0000 UTC">May 4, 2019</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;David
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#prelude aria-label=Prelude>Prelude</a></li>
<li>
<a href=#searching-for-strings-in-the-binary aria-label="Searching for Strings in the binary">Searching for Strings in the binary</a></li>
<li>
<a href=#searching-for-strings-in-the-mui aria-label="Searching for Strings in the MUI">Searching for Strings in the MUI</a></li>
<li>
<a href=#ending-notes aria-label="Ending Notes">Ending Notes</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h2 id=prelude>Prelude<a hidden class=anchor aria-hidden=true href=#prelude>#</a></h2>
<p>The Windows Binaries I&rsquo;m talking about here are the ones that comes default with Windows provided by Microsoft.</p>
<h2 id=searching-for-strings-in-the-binary>Searching for Strings in the binary<a hidden class=anchor aria-hidden=true href=#searching-for-strings-in-the-binary>#</a></h2>
<p>I was analyzing a Windows binary <code>C:\Windows\System32\where.exe</code> when I realized the help text of the binary cannot be found anywhere in the binary.</p>
<p>After some futher investigation using <code>Process Monitor</code> from Windows Sysinternals I found out that it is reading from <code>C:\Windows\System32\en-US\where.exe.mui</code> during it&rsquo;s execution.</p>
<h2 id=searching-for-strings-in-the-mui>Searching for Strings in the MUI<a hidden class=anchor aria-hidden=true href=#searching-for-strings-in-the-mui>#</a></h2>
<p>I did some googling to find out more about the MUI file type and realized that it&rsquo;s how Windows enable support for different user interface languages.</p>
<blockquote>
<p>Multilingual User Interface (MUI) enables the localization of user interfaces for globalized applications. MUI also supports the creation of resources for any number of user interface languages.</p>
</blockquote>
<p>Further googling on how to open it says that it can be opened using 7zip, so I did and found the strings in <code>.rsrc\string.txt</code> in the archieve.</p>
<pre tabindex=0><code>52	Type &quot;WHERE /?&quot; for usage help.\n
58	ERROR: Invalid directory specified.\n
60	ERROR: &quot;$env:pattern&quot; cannot be used with /R.\n
63	ERROR: Missing pattern in &quot;$env:pattern&quot;.\n
64	INFO: Could not find &quot;%s&quot;.\n
--------------------------snip--------------------------
</code></pre><p>What&rsquo;s weird is when I ran linux&rsquo;s <code>strings</code> on the MUI file which did not manage to find the strings in the MUI file, so I initially thought that the MUI file is compressed.</p>
<p>I then ran <code>file</code> on <code>where.exe.mui</code> and it returned <code>PE32 executable (DLL) (GUI) Intel 80386, for MS Windows</code>, I thought that&rsquo;s weird, so I tried opening the file in CFF Explorer and it worked! So a MUI file is actually a PE file.</p>
<p>If we check the resource directories of <code>where.exe.mui</code> using CFF Explorer we can see a resource directory called <code>String Tables</code>. If we check the data within the Directory, we can find all the strings we previously seen using 7zip.</p>
<p>The only thing that&rsquo;s weird was each character was followed by a null byte, which turns out to be because the strings are stored as unicode. Now it makes sense why linux&rsquo;s <code>strings</code> did not find anything, it does not search for unicode strings. I tried again with the <code>strings</code> tool from Windows Sysinternals and it managed to find the strings because it also searches for unicode strings.</p>
<p>I also looked at <code>bash.exe.mui</code> and realized that the strings can also be in the <code>MESSAGETABLE</code> section of the resource directory, which have the ID of <code>0xb</code>.</p>
<blockquote>
<p>All the resource type can be found from the <a href=https://docs.microsoft.com/en-us/windows/desktop/menurc/resource-types>Microsoft Documentation</a>.</p>
</blockquote>
<h2 id=ending-notes>Ending Notes<a hidden class=anchor aria-hidden=true href=#ending-notes>#</a></h2>
<p>Most of the Windows binaries does this, but not all, if you want to extract all the strings used by a Windows binary you should combine finding strings in the binary and the MUI.</p>
<p>The strings can be in <code>STRING</code> (ID of <code>0x6</code>) and <code>MESSAGETABLE</code> (ID of <code>0xb</code>) section of the resource directory of the MUI file.</p>
<p>I have made a <a href=https://github.com/PotatoDrug/MUI-Strings>tool in rust</a> to retrieve the strings from a MUI file.</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://dzhy.dev/tags/windows/>Windows</a></li>
<li><a href=https://dzhy.dev/tags/reverse-engineering/>Reverse Engineering</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://dzhy.dev/posts/2019-05-21-system32-magic/>
<span class=title>« Prev Page</span>
<br>
<span>System32 Magic</span>
</a>
<a class=next href=https://dzhy.dev/posts/2019-04-11-securing-email-domain/>
<span class=title>Next Page »</span>
<br>
<span>Preventing Email Spoofing</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://dzhy.dev/>David Zhu | Blog</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script>
<script>mermaid.initialize({startOnLoad:!0,theme:'dark'})</script>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>